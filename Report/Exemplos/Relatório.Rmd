---
title: "Gene Expression Signature of Cigarette Smoking and Its Role in Lung Adenocarcinoma Development and Survival"
author: "Helder Goncalves 64286 | Patricia Machado 30377 | Telma Afonso 30387"
date: "23 de junho, 2016"
bibliography: Referencias.bibtex

output:
  html_document:
    css: tableContents.css
    toc: true
    depth: 3
    number_sections: true 
    theme: united 
    highlight: tango

---

<img src="logo.png" style = "position:absolute;top:0px;right:0px;" />

```{r setup, cache = FALSE, echo = FALSE}
options(width = 107, digits = 4) #porque ao correr fazia wrap de algumas tabelas
knitr::opts_chunk$set(cache = TRUE, autodep = TRUE) #para por os objetos em cache e associar uns aos outros automaticamente
```


# Introdu??o
<p style = 'text-align: justify;'>
Este trabalho surge no ?mbito da disciplina de Extra??o de Conhecimento de Bases de Dados Biol?gicas, tendo como principal objetivo o desenvolvimento de scripts em R/Bioconductor para an?lise de dados de express?o gen?tica. Os dados analisados neste trabalho s?o provenientes de um estudo sobre o perfil de express?o gen?tica do consumo de tabaco e o papel deste no desenvolvimento de adenocarcinoma pulmonar [@landi2008gene].
</p>

<p style = 'text-align: justify;'>
O adenocarcinoma pulmonar ? uma forma comum de cancro no pulm?o, geralmente encontrada em fumadores, embora ocorra tamb?m em pessoas que nunca consumiram tabaco. Inicia-se normalmente nos tecidos exteriores do pulm?o, podendo permanecer indetet?vel durante longos per?odos de tempo. ? um dos tipos de cancro mais comuns e mortais e, no entanto, as altera??es a n?vel molecular induzidas pelo consumo de tabaco que levam ao desenvolvimento de cancro n?o s?o ainda totalmente conhecidas [@subramanian2007lung]. Deste modo, o estudo e compreens?o destes mecanismos de neoplasia pulmonar s?o essenciais, possibilitando a identifica??o de genes que poder?o estar associados no processo de desenvolvimento do cancro e, consequentemente, identificar poss?veis alvos a ter em conta no seu tratamento.
</p>

<p style = 'text-align: justify;'>
O estudo no qual este trabalho se baseia contou com 105 indiv?duos com adenocarcinoma pulmonar de idades entre os 44 e os 72 anos, pertencentes ao *Environment And Genetics in Lung cancer Etiology* (EAGLE), um outro estudo focado em cancro pulmonar na regi?o de Lombardy, em It?lia. Os dados de express?o gen?tica foram obtidos usando microarrays HG-U133A da Affimetrix, contando com 135 amostras de tecido normal (**NT**) e com adenocarcinoma (**T**), provenientes de indiv?duos atualmente fumadores (**C**), antigos fumadores (**F**) e nunca fumadores (**N**). Ap?s algum pr?-processamento realizado pelos autores o dataset final encontra-se j? normalizado, totalizando 107 amostras de 58 tecidos tumorais e 49 tecidos n?o tumorais, provenientes de 20 nunca fumadores, 26 antigos fumadores e 28 atualmente fumadores. O dataset utilizado neste trabalho encontra-se dispon?vel na base de dados GEO, do NCBI, sob o c?digo de acesso [GDS3257](http://www.ncbi.nlm.nih.gov/sites/GDSbrowser?acc=GDS3257).
</p>


# Carregamento e verifica??o dos dados
<p style = 'text-align: justify;'>
Packages necess?rios:
</p>

```{r installpacks, echo = FALSE, message = FALSE, warning = FALSE, include = FALSE}
source("http://www.bioconductor.org/biocLite.R")
biocLite("GEOquery")
biocLite("limma")
biocLite("hgu133a.db") #para a anota?ao dos genes
install.packages("caret", repos="http://cran.rstudio.com/")
install.packages("gtools", repos="http://cran.rstudio.com/")
install.packages("GOstats", repos="http://cran.rstudio.com/")
install.packages("MLInterfaces", repos="http://cran.rstudio.com/")
```

```{r packages, message = FALSE, warning = FALSE}
library(Biobase)
library(GEOquery)
library(hgu133a.db)
library(genefilter)
library(limma)
library(caret)
library(gtools)
library(GOstats)
library(gplots)
library(MLInterfaces)
```

<p style = 'text-align: justify;'>
Download e carregamento do dataset:
</p>

```{r dataset, message = FALSE}
gds3257 <- getGEO('GDS3257', destdir = ".")
```

<p style = 'text-align: justify;'>
Transformar o dataset num expressionset:
</p>

```{r expressionset, message = FALSE, warning = FALSE, dependson = "dataset"}
eset <- GDS2eSet(gds3257)
eset
```

## Dados

<p style = 'text-align: justify;'>
O expressionset cont?m 107 amostras e um total de 22283 features, correspondentes ?s 22283 sondas presentes no microarray.
</p>
<p style = 'text-align: justify;'>
Exemplo dos dados de express?o para os 10 primeiros genes e 6 primeiras amostras:
</p>

```{r dados, message = FALSE, warning = FALSE}
dados = exprs(eset)
dados[1:10,1:6]
```

<p style = 'text-align: justify;'>
Fazendo um boxplot com o logaritmo de base 2 dos dados de express?o para todas as amostras facilmente verificamos a escala e distribui??o dos dados. As caixas apresentam forma e centro semelhantes entre amostras, indicando que os dados de express?o j? est?o normalizados, tal como referido, e podem ent?o ser usados para termos de compara??o.
</p>

```{r boxplot, fig.width = 10, fig.align = 'center',  message = FALSE, warning = FALSE}
col = terrain.colors(length(pData(eset)$individual), alpha = 0.7)
boxplot(log2(dados), col = col, whiskcol = col, pch = 21, cex = 0.8, xlab = 'Amostras', ylab = 'Intensidades (log2)', notch = TRUE, frame = FALSE)
```


## Metadados

<p style = 'text-align: justify;'>
Os metadados apresentam 6 campos, entre os quais: *tissue*, se o tecido pulmonar da amostra ? de tumor ou normal, *individual*, se o indiv?duo ? atual, antigo ou nunca fumador, *disease.state*, indicando o estado em que se encontra o tumor no paciente e *gender*, indicando o sexo do paciente, al?m de outros campos de descri??o.
</p>

```{r metadados, message = FALSE, warning = FALSE}
vars = pData(eset)
names(vars)
levels(vars$tissue); levels(vars$individual); levels(vars$disease.state); levels(vars$gender)
```

<p style = 'text-align: justify;'>
Na tabela que se segue encontram-se o n?mero de amostras correspondentes ?s vari?veis *tissue* e *individual*, de modo a entender-se quantas das 107 amostras pertencem a cada vari?vel.
</p>

```{r varstabela, message = FALSE, warning = FALSE}
addmargins(table(vars$tissue,vars$individual))
```


# Preprocessamento

<p style = 'text-align: justify;'>
Verificar se existem NAs no expressionset:
</p>

```{r NAs, message = FALSE, warning = FALSE}
sum(which(is.na(dados)))
```

<p style = 'text-align: justify;'>
O expressionset n?o cont?m, portanto, dados omissos. Como verificamos anteriormente os dados j? se encontram normalizados e prontos a analisar. Todas as 22283 sondas (features) ser?o utilizadas nas subsequentes an?lises, abordagem tamb?m optada pelos autores [@landi2008gene]. Para a an?lise preditiva e de clustering optou-se por filtrar os dados, reduzindo o numero de features de modo a tornar o processo menos computacionalmente pesado, filtrando-se os genes cujo desvio padr?o dos valores de express?o ? maior do que duas vezes a mediana dos desvios padr?o de todos os genes:
</p>

```{r filtrados, message = FALSE, warning = FALSE}
sds = rowSds(dados)
m = median(sds)
eset.f = eset[sds > 2*m]
```

<p style = 'text-align: justify;'>
Visualmente corresponde a selecionarmos todos os genes cujo desvio padr?o dos valores de express?o se situa para l? da linha verde no histograma abaixo:
</p>

```{r histograma, fig.align = 'center', message = FALSE, warning = FALSE}
hist(sds,breaks = 50,ylim = c(0,4000),col = "tomato",xlab = 'Desvio padr?o',ylab = 'Frequ?ncia',main = NULL)
abline(v = m*2, col = "olivedrab3",lwd = 3,lty = 2)
```

# An?lise de express?o diferencial e de enriquecimento
<p style = 'text-align: justify;'>
As an?lises estat?sticas que se seguem foram realizadas utilzando o package *limma* [@ritchie2015limma], uma biblioteca para an?lise de express?o gen?tica em dados e microarrays, que permite a cria??o de modelos lineares usando uma extens?o Bayes emp?rica da ANOVA, apropriada para estudos deste tipo. Os genes de interesse identificados por estas an?lises estat?sticas foram ent?o submetidos a uma an?lise de enriquecimento, de modo a verificar se neste conjunto de genes existe "enriquecimento" estatisticamente significativo nos genes de algum (ou v?rios) conjuntos de outros genes biologicamente coerentes. Esta ?ltima an?lise foi realizada usando o package *GOstats* [@falcon2007using], que permite testar listas de genes para associa??o de termos de Gene Ontology (GO).
</p>

<p style = 'text-align: justify;'>
De modo a tentar encontrar altera??es moleculares associadas com o consumo de tabaco, foi realizada uma an?lise de express?o diferencial entre atuais fumadores e nunca fumadores (**C**/**N**) e antigos fumadores e nunca fumadores (**F**/**N**), para todas as amostras tumorais, para as primeiras fases de tumor (fases I e II) e para todas as amostras de tecido normal. A an?lise de amostras de tecido tumoral nas primeiras fases poder? ser mais apropriada, uma vez que o estado avan?ado do tumor poder? causar potenciais altera??es de express?o gen?tica. Como crit?rio de signific?ncia definiu-se p-value < 0.01 e Fold Change > 1.5.
</p>

## Nunca fumadores vs. atuais fumadores (Tecido tumoral)
<p style = 'text-align: justify;'>
Cria??o do design para o modelo linear, definindo *never smoker* como refer?ncia:
</p>

```{r design1, message = FALSE, warning = FALSE}
eset.tumor = eset[, eset$tissue == "tumor"]
indivs1 = relevel(eset.tumor$individual, 'never smoker')
design1 = model.matrix(~ indivs1)
head(design1)
```

<p style = 'text-align: justify;'>
Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo1, message = FALSE, warning = FALSE}
fit1 = lmFit(eset.tumor, design1)
fit.bayes1 = eBayes(fit1) 
diff1 = topTable(fit.bayes1, coef = 2, 1000, genelist = fit1$genes$NAME)
diff1[1:10,]
```


<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia definido anteriormente (p-value < 0.01 e Fold Change > 1.5):
</p>

```{r genes1, message = FALSE, warning = FALSE}
treshold = foldchange2logratio (1.5)
upregulated1 = diff1[which(diff1$logFC > treshold & diff1$adj.P.Val < 0.01),]
downregulated1 = diff1[which(diff1$logFC < -treshold & diff1$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated1),hgu133aSYMBOL))
unlist(mget(rownames(downregulated1),hgu133aSYMBOL))
```


<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, existem 30 genes sobreexpressos (em 33 sondas) e 8 genes (em 8 sondas) subexpressos em tecido tumoral de pacientes fumadores em rela??o aos nunca fumadores. De seguida ser? realizada uma an?lise de enriquecimento de modo a tentar determinar a classe biol?gica mais prov?vel em que este conjunto de genes se enquadra. 
</p>

<p style = 'text-align: justify;'>
Para esta e as seguintes an?lises de enriquecimento considerou-se como crit?rio de signific?ncia p-value < 0.025. O universo de genes corresponde ? totalidade de genes exitentes no expressionset.
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes sobrexpressos:**
</p>

```{r GOsobre1, message = FALSE, warning = FALSE}
entrezUniverse = unlist(mget(featureNames(eset), hgu133aENTREZID))
selectedEntrezIds1 = unlist(mget(rownames(upregulated1), hgu133aENTREZID))
params1 = new("GOHyperGParams", geneIds = selectedEntrezIds1, universeGeneIds = entrezUniverse, 
             annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver1 = hyperGTest(params1)
summary(hgOver1)[1:15,]
```

<p style = 'text-align: justify;'>
O resultado anterior aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a divis?o/ciclo celular, processo de mitose e segrega??o dos cromossomas, entre outros. Considerando que uma das carater?sticas mais evidentes no desenvolvimento do cancro passa pela r?pida e descontrolada prolifera??o celular estes resultados v?o de encontro ao que seria de esperar. De facto, entre os genes identificados est?o o "TTK" (codifica prote?na essecial no alinhamento cromossomal durante a mitose [@mills1992expression]), "ECT2" (pensa-se que poder? ter um papel importante na regula??o da citocinese [@tatsumoto1999human]) e "CENPF" (indispens?vel para a fun??o do cinet?coro e segrega??o cromossomal durante a mitose [@liao1995cenp]), entre outros, refor?ando o resultado obtido.
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes subexpressos:**
</p>

```{r GOsub1, message = FALSE, warning = FALSE}
selectedEntrezIds2 = unlist(mget(rownames(downregulated1), hgu133aENTREZID))
params2 = new("GOHyperGParams", geneIds = selectedEntrezIds2, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver2 = hyperGTest(params2)
summary(hgOver2)[c(1:6,8:14),] #linha 7 demasiado longa
```

<p style = 'text-align: justify;'>
A an?lise de enriquecimento para genes subexpressos aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com o processo de resposta de defesa celular e imunologia. Entre os genes identificados encontram-se o "SDC1" (codifica prote?na transmembranar respons?vel por mediar a liga??o e sinaliza??o celular [@lories1992differential]) e "CIRBP" (induzido pelo frio, codifica uma prote?na com papel protetor na resposta a stress genot?xico, estabilizando os transcritos involvidos na sobreviv?ncia celular [@nishiyama1997cloning]), entre outros. Estas fun??es v?m refor?ar o resultado obtido na an?lise de enriquecimento. O facto de o gene "SDC1" ser subexpresso e estar relacionado com a liga??o celular tamb?m vai de certo modo de encontro ao esperado, j? que uma outra carater?stica em cancros ? a metastiza??o, podendo as c?lulas libertarem-se do local do tumor e viajar pela corrente sangu?nea, alastrando o tumor a outros ?rg?os.
</p>

## Nunca fumadores vs. antigos fumadores (Tecido tumoral)
<p style = 'text-align: justify;'>
O design usado neste caso ? o mesmo que no caso anterior. Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo2, message = FALSE, warning = FALSE}
fit2 = lmFit(eset.tumor, design1)
fit.bayes2 = eBayes(fit2) 
diff2 = topTable(fit.bayes2, coef = 3, 1000, genelist = fit2$genes$NAME)
diff2[1:10,]
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes2, message = FALSE, warning = FALSE}
upregulated2 = diff2[which(diff2$logFC > treshold & diff2$adj.P.Val < 0.01),] 
downregulated2 = diff2[which(diff2$logFC < -treshold & diff2$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated2),hgu133aSYMBOL))
unlist(mget(rownames(downregulated2),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, n?o existem genes sobre ou subexpressos em tecidos provenientes de antigos fumadores relativamente aos tecido provenientes de nunca fumadores.
</p>


## Nunca fumadores vs. atuais fumadores (Tecido tumoral - fases I e II)
<p style = 'text-align: justify;'>
Cria??o do design para o modelo linear, definindo *never smoker* como refer?ncia:
</p>

```{r design2, message = FALSE, warning = FALSE}
eset.stumor = eset[, eset$tissue == "tumor" & (eset$disease.state == 'stage I' | eset$disease.state == 'stage II')]
indivs2 = relevel(eset.stumor$individual, 'never smoker')
design2 = model.matrix(~ indivs2)
head(design2)
```

<p style = 'text-align: justify;'>
Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo3, message = FALSE, warning = FALSE}
fit3 = lmFit(eset.stumor, design2)
fit.bayes3 = eBayes(fit3) 
diff3 = topTable(fit.bayes3, coef = 2, 1000, genelist = fit3$genes$NAME)
head(diff3)
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes3, message = FALSE, warning = FALSE}
upregulated3 = diff3[which(diff3$logFC > treshold & diff3$adj.P.Val < 0.01),]
downregulated3 = diff3[which(diff3$logFC < -treshold & diff3$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated3),hgu133aSYMBOL))
unlist(mget(rownames(downregulated3),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, existem 9 genes sobreexpressos (em 10 sondas) e 9 genes subexpressos (em 9 sondas) em tecido tumoral de pacientes fumadores em rela??o aos nunca fumadores. De seguida ser? realizada uma an?lise de enriquecimento de modo a tentar determinar a classe biol?gica mais prov?vel em que este conjunto de genes se enquadra. 
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes sobrexpressos:**
</p>

```{r GOsobre2, message = FALSE, warning = FALSE}
selectedEntrezIds3 = unlist(mget(rownames(upregulated3), hgu133aENTREZID))
params3 = new("GOHyperGParams", geneIds = selectedEntrezIds3, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver3 = hyperGTest(params3)
summary(hgOver3)[1:15,]
```

<p style = 'text-align: justify;'>
O resultado anterior aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a divis?o/ciclo celular, processo de mitose e regula??o/segrega??o cromossomal, entre outros. Estes resultados s?o, de facto, semelhantes aqueles obtidos quando consideramos todas as fases tumorais. Tamb?m aqui os genes mencionados anteriormente est?o entre os mais sobrexpressos, cuja fun??o se relaciona com o resultado obtido. No entanto quando apenas consideramos as primeiras fases tumorais (fases I e II) o nr de genes sobrexpressos diminui, o que poder? estar relacionado com o facto mencionado anteriormente de o estado avan?ado do tumor (n?o considerado aqui) poder causar potenciais altera??es na express?o gen?tica.
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes subexpressos:**
</p>

```{r GOsub2, message = FALSE, warning = FALSE}
selectedEntrezIds4 = unlist(mget(rownames(downregulated3), hgu133aENTREZID))
params4 = new("GOHyperGParams", geneIds = selectedEntrezIds4, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver4 = hyperGTest(params4)
summary(hgOver4)[1:15,] #linhas demasiado longas
```

<p style = 'text-align: justify;'>
A an?lise de enriquecimento para genes subexpressos aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com distriui??o/localiza??o/polariza??o de *rafts* na membrana plasm?tica, regula??o de macromitofagia (forma especializada de autofagia pela qual se degradam e reciclam selectivamente as mitocondrias) e ainda com a organiza??o da matrix extracelular. Sendo a matriz extracelular constituida por um conjunto de mol?culas que conferem suporte estrutural e bioqu?mico ?s c?lulas circundantes, alguns dos genes identificados poder?o estar relacionados com a metastiza??o do tumor. Uma outra carater?stica comum a c?lulas cancer?genas consiste numa maior resist?ncia ? apoptose mitocondrial, pelo que seria de esperar genes que regulam positivamente este processo estarem subexpressos. Entre os genes mais subespressos est?o o "ADRB2" (envolvido no processo de ades?o celular [@boulay2012loss]) e "SDC1" (envolvido com a matrix celular e processo de ades?o celular [@lories1992differential]), entre outros.

## Nunca fumadores vs. antigos fumadores (Tecido tumoral - fases I e II)
<p style = 'text-align: justify;'>
O design usado neste caso ? o mesmo que no caso anterior. Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo4, message = FALSE, warning = FALSE}
fit4 = lmFit(eset.stumor, design2)
fit.bayes4 = eBayes(fit4) 
diff4 = topTable(fit.bayes4, coef = 3, 1000, genelist = fit4$genes$NAME)
head(diff4)
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes4, message = FALSE, warning = FALSE}
upregulated4 = diff4[which(diff4$logFC > treshold & diff4$adj.P.Val < 0.01),] 
downregulated4 = diff4[which(diff4$logFC < -treshold & diff4$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated4),hgu133aSYMBOL))
unlist(mget(rownames(downregulated4),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, n?o existem genes sobre ou subexpressos em tecidos provenientes de antigos fumadores relativamente aos tecido provenientes de nunca fumadores.
</p>


## Nunca fumadores vs. atuais fumadores (Tecido normal)
<p style = 'text-align: justify;'>
Cria??o do design para o modelo linear, definindo *never smoker* como refer?ncia:
</p>

```{r design3, message = FALSE, warning = FALSE}
eset.normal = eset[, eset$tissue == "normal"]
indivs3 = relevel(eset.normal$individual, 'never smoker')
design3 = model.matrix(~ indivs3)
head(design3)
```

<p style = 'text-align: justify;'>
Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo5, message = FALSE, warning = FALSE}
fit5 = lmFit(eset.normal, design3)
fit.bayes5 = eBayes(fit5) 
diff5 = topTable(fit.bayes5, coef = 2, 1000, genelist = fit5$genes$NAME)
head(diff5)
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes5, message = FALSE, warning = FALSE}
upregulated5 = diff5[which(diff5$logFC > treshold & diff5$adj.P.Val < 0.01),]
downregulated5 = diff5[which(diff5$logFC < -treshold & diff5$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated5),hgu133aSYMBOL)) 
unlist(mget(rownames(downregulated5),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, existem 7 genes sobreexpressos (em 9 sondas) e 11 genes subexpressos (em 11 sondas) em tecido normal de pacientes fumadores em rela??o aos nunca fumadores. De seguida ser? realizada uma an?lise de enriquecimento de modo a tentar determinar a classe biol?gica mais prov?vel em que este conjunto de genes se enquadra. 
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes sobrexpressos:**
</p>

```{r GOsobre3, message = FALSE, warning = FALSE}
selectedEntrezIds5 = unlist(mget(rownames(upregulated5), hgu133aENTREZID))
params5 = new("GOHyperGParams", geneIds = selectedEntrezIds5, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver5 = hyperGTest(params5)
summary(hgOver5)[c(1:12,14:15),] #linha 13 demasiado longa
```

<p style = 'text-align: justify;'>
O resultado anterior aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a defesa celular e resposta imunol?gica. Entre os genes mais sobrexpressos, como seria de esperar, encontra-se o "CYP1B1", um gene que se sabe ser induzido pelo consumo de tabaco [@lampe2004signatures] e cuja enzima codificada metaboliza procarcin?genos, subst?ncias qu?micas que se tornam carcin?genos ap?s metabolizadas.
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes subexpressos:**
</p>

```{r GOsub3, message = FALSE, warning = FALSE}
selectedEntrezIds6 = unlist(mget(rownames(downregulated5), hgu133aENTREZID))
params6 = new("GOHyperGParams", geneIds = selectedEntrezIds6, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver6 = hyperGTest(params6)
summary(hgOver6)[c(1:4,6:15),-4] #linha 5 demasiado longa
```

<p style = 'text-align: justify;'>
A an?lise de enriquecimento para genes subexpressos aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com processos metab?licos e, interessantemente, com a morfog?nese/deseonvolvimento da gl?ndula mam?ria. Embora este estudo seja em adenocarcinoma pulmonar, n?o deixa de ser interessante verificar que, em tecido normal de fumadores, haja express?o diferencial em genes relacionados com a morfog?nese/desenvolvimento da gl?ndula mam?ria, uma vez que se pensa que o consumo do tabaco est? relacionado com o surgimento do cancro da mama [@catsburg2014active]. No entanto, poder? tratar-se apenas de uma coincid?ncia. Entre os genes mais subespressos est?o o "DPT", "ARHGEF4" e "NUAK1", todos eles relacionados com o processo de ades?o celular [@superti1993complementary; @thiesen2000isolation; @hou2011new].
</p>


## Nunca fumadores vs. antigos fumadores (Tecido normal)
<p style = 'text-align: justify;'>
O design usado neste caso ? o mesmo que no caso anterior. Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo6, message = FALSE, warning = FALSE}
fit6 = lmFit(eset.normal, design3)
fit.bayes6 = eBayes(fit6) 
diff6 = topTable(fit.bayes6, coef = 3, 1000, genelist = fit6$genes$NAME)
head(diff6)
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes6, message = FALSE, warning = FALSE}
upregulated6 = diff6[which(diff6$logFC > treshold & diff6$adj.P.Val < 0.01),] 
downregulated6 = diff6[which(diff6$logFC < -treshold & diff6$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated6),hgu133aSYMBOL))
unlist(mget(rownames(downregulated6),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, existem 3 genes sobreexpressos (em 3 sondas) e 1 gene subexpressos (em duas sondas) em tecido normal de pacientes antigos fumadores em rela??o aos nunca fumadores. De seguida ser? realizada uma an?lise de enriquecimento de modo a tentar determinar a classe biol?gica mais prov?vel em que este conjunto de genes se enquadra. 
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes sobrexpressos:**
</p>

```{r GOsobre4, message = FALSE, warning = FALSE}
selectedEntrezIds7 = unlist(mget(rownames(upregulated6), hgu133aENTREZID))
params7 = new("GOHyperGParams", geneIds = selectedEntrezIds7, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver7 = hyperGTest(params7)
summary(hgOver7)[1:15,]
```

<p style = 'text-align: justify;'>
O resultado anterior aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a defesa celular e resposta imunol?gica ("KDM5D" [@rezvani2008characterizing],"DDX3Y" [@rosinski2008ddx3y]), bioss?ntese e processamento de p?ptidos e histonas ("RPS4Y1", [@andres2008rps4y]).
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes subexpressos:**
</p>

```{r GOsub4, message = FALSE, warning = FALSE, error = 4}
selectedEntrezIds8 = unlist(mget(rownames(downregulated6), hgu133aENTREZID))
params8 = new("GOHyperGParams", geneIds = selectedEntrezIds8, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver8 = hyperGTest(params8)
```

<p style = 'text-align: justify;'>
Como podemos verificar, esta an?lise n?o pode ser realizado pois o gene a ser testado, "XIST", n?o tem nenhum termo GO correspondente. Este gene est? envolvido na inativa??o de uma das c?pias do cromossoma X em mam?feros do g?nero feminino. 
</p>

## Antigos fumadores vs. atuais fumadores (Tecido tumoral - fases I e II)
<p style = 'text-align: justify;'>
De modo a verificar se o padr?o verificado entre atuais fumadores/nunca fumadores tamb?m ? verificado para antigos fumadores foi realizada uma an?lise de express?o gen?tica entre atuais fumadores e antigos fumadores em tecidos tumorais nas primeiras fases.
</p>

<p style = 'text-align: justify;'>
Cria??o do design para o modelo linear (*current smoker* como refer?ncia):
</p>

```{r design4, message = FALSE, warning = FALSE}
design4 = model.matrix(~ eset.stumor$individual)
head(design4)
```

<p style = 'text-align: justify;'>
Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo7, message = FALSE, warning = FALSE}
fit7 = lmFit(eset.stumor, design4)
fit.bayes7 = eBayes(fit7) 
diff7 = topTable(fit.bayes7, coef = 2, 1000, genelist = fit7$genes$NAME)
head(diff7) 
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes7, message = FALSE, warning = FALSE}
upregulated7 = diff7[which(diff7$logFC > treshold & diff7$adj.P.Val < 0.01),]
downregulated7 = diff7[which(diff7$logFC < -treshold & diff7$adj.P.Val < 0.01),]
unlist(mget(rownames(upregulated7),hgu133aSYMBOL))
unlist(mget(rownames(downregulated7),hgu133aSYMBOL))
```

<p style = 'text-align: justify;'>
Verificamos que, para o crit?rio de signific?ncia definido, n?o existem genes diferencialmente expressos entre antigos fumadores relativamente a atuais fumadores. Isto poder? indicar que embora os pacientes j? tivessem deixado de fumar h? algum tempo as altera??es a n?vel dos genes se manteve.
</p>


## Tabela resumo da an?lise de express?o diferencial
<p style = 'text-align: justify;'>
Na seguinte tabela encontram-se resumidos o nr de genes identificados durante as an?lises de express?o diferencial anteriores:
</p>

|     Tecido    |     Tumor    |              | Tumor (fases I e II) |      |    Normal     |              |
----------------|--------------|--------------|--------------|--------------|---------------|--------------|
**Condi??o**    |**24C vs 16N**|**18F vs 16N**|**20C vs 10N**|**13F vs 10N**|**16C vs 15N** |**18F vs 15N**|
**Genes Sobr**  |      30      |      0       |     9        |      0       |       7       |       3      |
**Sondas Sobr** |      33      |      0       |     10       |      0       |       9       |       3      |
**Genes Sub**   |      8       |      0       |     9        |      0       |       11      |       1      |
**Sondas Sub**  |      8       |      0       |     9        |      0       |       11      |       2      |
|               |              |              |              |              |               |              |


Table: **Tabela 1** - N?mero de sondas e genes (sobre e subexpressos) diferenciando atuais fumadores (**C**) de nunca fumadores (**N**) e antigos fumadores (**F**) de nunca fumadores em todas as amostras tumorais, amostras tumorais em fase I ou II e amostras de tecido normal. Como crit?rio de signific?ncia para an?lise definiu-se p-value < 0.01 e Fold Change > 1.5.


## Tecido normal vs. tecido normal
<p style = 'text-align: justify;'>
Uma an?lise de express?o diferencial foi tamb?m relizada entre amostras provenientes de tecido normal vs. tecido tumoral, de modo a obter-se uma vis?o geral express?o de genes nos dois tecidos sem ter em conta o perfil do paciente.
</p>

<p style = 'text-align: justify;'>
Cria??o do design para o modelo linear (*normal* como refer?ncia):
</p>

```{r design5, message = FALSE, warning = FALSE}
design5 = model.matrix(~ eset$tissue)
head(design5)
```

<p style = 'text-align: justify;'>
Cria??o dos modelos lineares de regress?o e realiza??o dos testes estat?sticos:
</p>

```{r modelo8, message = FALSE, warning = FALSE}
fit8 = lmFit(eset, design5)
fit.bayes8 = eBayes(fit8) 
diff8 = topTable(fit.bayes8, coef = 2, 1000, genelist = fit8$genes$NAME)
head(diff8) 
```

<p style = 'text-align: justify;'>
De acordo com os testes anteriores verificar quais o genes mais diferentemente expressos, usando o crit?rio de signific?ncia j? definido:
</p>

```{r genes8, message = FALSE, warning = FALSE}
upregulated8 = diff8[which(diff8$logFC > treshold & diff8$adj.P.Val < 0.01),]
downregulated8 = diff8[which(diff8$logFC < -treshold & diff8$adj.P.Val < 0.01),]
length(unlist(mget(rownames(upregulated8),hgu133aSYMBOL))) #nr sondas
length(unique(unlist(mget(rownames(upregulated8),hgu133aSYMBOL)))) #nr genes
length(unlist(mget(rownames(downregulated8),hgu133aSYMBOL)))
length(unique(unlist(mget(rownames(downregulated8),hgu133aSYMBOL))))
```

<p style = 'text-align: justify;'>
Devido ao elevado n?mero de genes no resultado optou-se por apresentar o n?mero total de genes em vez da lista de genes em si. Verificamos que, para o crit?rio de signific?ncia definido, existem 227 genes sobreexpressos (em 284 sondas) e 481 genes subexpressos (em 636 sondas) em tecido tumoral relativamente ao tecido normal. De seguida ser? realizada uma an?lise de enriquecimento de modo a tentar determinar a classe biol?gica mais prov?vel em que este conjunto de genes se enquadra. 
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes sobrexpressos:**
</p>

```{r GOsobre5, message = FALSE, warning = FALSE}
selectedEntrezIds9 = unlist(mget(rownames(upregulated8), hgu133aENTREZID))
params9 = new("GOHyperGParams", geneIds = selectedEntrezIds9, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver9 = hyperGTest(params9)
summary(hgOver9)[1:15,]
```

<p style = 'text-align: justify;'>
O resultado anterior aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a divis?o celular, ciclo mit?tico e processos catab?licos de a??cares. Isto vai de encontro ao esperado por raz?es anteriormente referidas. A sobrexpress?o de genes relacionados com o catabolismo de a??cares ? consistente com o facto de as c?lulas cancer?genas alterarem o seu metabolismo de forma a conseguirem uma mais r?pida prolifera??o [@annibaldi2010glucose].
</p>

<p style = 'text-align: justify;'>
**An?lise de enriquecimento para os genes subexpressos:**
</p>

```{r GOsub5, message = FALSE, warning = FALSE}
selectedEntrezIds10 = unlist(mget(rownames(downregulated8), hgu133aENTREZID))
params10 = new("GOHyperGParams", geneIds = selectedEntrezIds10, universeGeneIds = entrezUniverse, 
              annotation = "hgu133a.db", ontology = "BP", pvalueCutoff = 0.025, testDirection = "over")
hgOver10 = hyperGTest(params10)
summary(hgOver10)[1:15,]
```

<p style = 'text-align: justify;'>
A an?lise de enriquecimento para genes subexpressos aponta para uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com o desenvolvimento do sistema cardiovascular/circulat?rio, morfog?nese e desenvolvimento de vasos sangu?neos, entre outros. Embora este resultado possa parecer contradit?rio relativamente ao que se sabe sobre o cancro, nomeadamente no que toca ao aumento do mecanismo de angiog?nese, foi demonstrado que em alguns tipos de cancro o mecanismo de angiog?nese n?o ? assim t?o relevante e ?, em muitos casos, diminuido [@boneberg2009angiogenesis], pelo que o adenocarcinoma pulmonar poder? ser um desses casos.
</p>


# Clustering
<p style = 'text-align: justify;'>
Uma an?lise de clustering hier?rquico foi realizada sobre os dados anteriormente filtrados do expression set, de modo a tentar perceber se existe um agrupamento evidente entre amostras de acordo com os valores de express?o. A dist?ncia entre clusters foi calculada pelo m?todo *average linkage*, sendo a matriz de dist?ncias calculada usando a f?rmula um menos a correla??o de Pearson, abordagem tamb?m optada pelos autores deste estudo [@landi2008gene].
</p>

<p style = 'text-align: justify;'>
Clustering hier?rquico com c?lculo da matriz de dist?ncias (usando dados filtrados):
</p>

```{r distmat, message = FALSE, warning = FALSE}
corPDist = as.dist(1 - cor(exprs(eset.f), method = "pearson"))
cl.hier = hclust (corPDist, method = "average")
```

<p style = 'text-align: justify;'>
De modo a ser poss?vel a coloca??o de cores no resultado do clustering, para uma melhor visualiza??o dos resultados, foi necess?ria a cria??o da fun??o auxiliar que se segue:
</p>

```{r auxfun, message = FALSE, warning = FALSE}
clusMember = cutree(cl.hier, 2)
labelCol = c('coral1', 'darkolivegreen3')

colLab <- function(n) {
  if (is.leaf(n)) {
    a <- attributes(n)
    labCol <- labelCol[clusMember[which(names(clusMember) == a$label)]]
    attr(n, "nodePar") <- c(a$nodePar, lab.col = labCol)
  }
  n
}
```

<p style = 'text-align: justify;'>
O resultado da an?lise de clustering hier?rquico pode ent?o ser visualizado fazendo um plot, colocando cores de acordo com o tipo de tecido associado a cada amostra (tecido tumoral ou normal):
</p>


```{r hclust, fig.align = 'center', fig.width = 10, message = FALSE, warning = FALSE}
clusDendro = dendrapply(as.dendrogram(cl.hier), colLab)
par(cex = 0.6); plot(clusDendro, axes = F, ylim = c(0, 0.35))
par(cex = 0.9); title(xlab="Amostras", ylab="Dist?ncias", main = NULL); axis(2)
legend('topright', c('Tecido tumoral', 'Tecido normal'), fill = c('coral1', 'darkolivegreen3'), bty = "n")
```

<p style = 'text-align: justify;'>
Analisando o gr?fico verifica-se a forma??o de dois clusters evidentes, estando as amostras de tecido tumoral e tecido normal em ramos diferentes da ?rvore. Isto significa que os genes provenientes de tecido tumoral apresentam, no geral, um n?vel de express?o mais pr?ximo entre si do que em rela??o aos genes provenientes de tecido normal. Isto vai de encontro ao esperado, j? que o adenocarcinoma apresenta carater?sticas pr?prias que v?o depender da sobrexpress?o de alguns genes (relacionados com a multiplica??o celular, mitose, etc.) e subexpress?o de outros (relacionados com a ades?o celular, mitofagia, etc.), havendo assim diferen?as na express?o entre os dois tecidos.
</p>

<p style = 'text-align: justify;'>
De seguida realizou-se uma an?lise de clustering tanto para amostras, semelhante ao que foi feito, como para as sondas, isto ?, aplicando o clustering ?s colunas e linhas. Assim, definiram-se duas fun??es auxiliares, uma para c?lculo da matriz de dist?ncias e outra para o clustering, necess?rias para a cria??o do *heatmap*.
</p>

<p style = 'text-align: justify;'>
Fun??o auxiliar para c?lculo da matriz de dist?ncias:
</p>

```{r funcDist, message = FALSE, warning = FALSE}
dist.fun = function(x) {
  return (as.dist (1 - cor(t (x), method = "pearson")))
}
```

<p style = 'text-align: justify;'>
Fun??o auxiliar para realiza??o do clustering hier?rquico:
</p>

```{r funcClust, message = FALSE, warning = FALSE}
clust.fun = function (x) {
  return (hclust (x, method = "average"))
}
```

<p style = 'text-align: justify;'>
Uma outra fun??o foi tamb?m definida de modo a poder ser aplicada no *heatmap* para associar uma cor a cada tipo de tecido, nomeadamente verde para amostras de tecido tumoral e amarelo para amostras de tecido normal.
</p>

```{r clustCol, message = FALSE, warning = FALSE}
color.map.tissue <- function(tissue) { if (tissue == "tumor") "darkolivegreen3" else "lightgoldenrod1" }
tissuecolors <- unlist(lapply(eset.f$tissue, color.map.tissue))
```

<p style = 'text-align: justify;'>
Definindo previamente todas estas fun??es o *heatmap* pode ent?o ser criado:
</p>

```{r heatmap, fig.align = 'center', fig.width = 9, fig.height = 7, message = FALSE, warning = FALSE}
heatmap.2(exprs(eset.f), col = colorRampPalette(c("tomato", "seashell1", "steelblue1")), scale = "none", 
          ColSideColors = tissuecolors, key = TRUE, symkey = FALSE, density.info = "none", trace = "none", 
          cexRow = 0.5, distfun = dist.fun, hclustfun = clust.fun, labRow = F, margins = c(6,16), 
          ylab = "Sondas", xlab = "Amostras")

legend('topright', c("Tecido normal","Tecido tumoral"), bty = "n", fill = c("lightgoldenrod1", "darkolivegreen3"))
```

<p style = 'text-align: justify;'>
De acordo com o resultado do heatmap observamos uma clara separa??o de express?o gen?tica entre amostras provenientes de tecido tumoral e tecido normal. Al?m disso, dentro do mesmo tipo de tecido observa-se a forma??o de dois grupos de genes, pertencentes a ramos diferentes da ?rvore de clustering, sendo que um dos grupos ? mais subexpresso do que o outro. Em tecido tumoral verificamos uma maior subexpress?o de genes relativamente aos genes presentes em tecido normal, principalmente no grupo de genes do cluster mais acima. Por outro lado, tamb?m existem genes mais subexpressos em tecido tumoral relativamente ao normal, embora menos, resultado que vai de encontro ? an?lise de express?o gen?tica entre os dois tecidos realizada previamente (227 genes sobrexpressos contra 481 genes subexpressos, em tecido tumoral). Das an?lises anteriores sabemos que os genes sobrexpressos em tecido tumoral est?o envolvidos nos processos de divis?o celular, mitose e catabolismo de a??cares e os subexpressos est?o envolvidos no mecanismo de angiog?nese.
</p>


# An?lise Preditiva

<p style = 'text-align: justify;'>
Uma an?lise preditiva foi realizada para previs?o tanto do tipo de tecido (tumor/normal) como para o perfil do indiv?duo (atual/antigo ou nunca fumador). Para tal usou-se o package *MLInterfaces* [@MLInterfaces2016], que disponibiliza uma forma standard de parametriza??o e apresenta??o de resultados dos algoritmos de aprendizagem. Na an?lise usaram-se os m?todos de *machine learning* de K-vizinhos mais pr?ximos, ?rvores de regress?o e m?quinas de vetores de suporte (SVMs), usando o m?todo de valida??o cruzada que permite o uso de todos os dados dispon?veis. O n?mero de itera??es para a valida??o cruzada foi definido como 10.
</p>

## K-vizinhos mais pr?ximos

**Previs?o de tipo de tecido**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r knn1, message = FALSE, warning = FALSE}
knnResult.tissue.cv <- MLearn(tissue ~ ., eset.f, knnI(k = 1), xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(knnResult.tissue.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do tipo de tecido:
</p>

```{r pecc1, message = FALSE, warning = FALSE}
precision(confuMat(knnResult.tissue.cv))
```

**Previs?o do perfil do indiv?duo**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r knn2, message = FALSE, warning = FALSE}
knnResult.indivs.cv <- MLearn(individual ~ ., eset.f, knnI(k = 1), xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(knnResult.indivs.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do perfil do indiv?duo:
</p>

```{r pecc2, message = FALSE, warning = FALSE}
precision(confuMat(knnResult.indivs.cv))
```


## ?rvores de regress?o

**Previs?o de tipo de tecido**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r arv1, message = FALSE, warning = FALSE}
treeResult.tissue.cv <- MLearn(tissue ~ ., eset.f, rpartI, xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(treeResult.tissue.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do tipo de tecido:
</p>

```{r pecc3, message = FALSE, warning = FALSE}
precision(confuMat(treeResult.tissue.cv))
```

**Previs?o do perfil do indiv?duo**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r arv2, message = FALSE, warning = FALSE}
treeResult.indivs.cv <- MLearn(individual ~ ., eset.f, rpartI, xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(treeResult.indivs.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do perfil do indiv?duo:
</p>

```{r pecc4, message = FALSE, warning = FALSE}
precision(confuMat(treeResult.indivs.cv))
```

## M?quinas de vetores de suporte (SVMs)

**Previs?o de tipo de tecido**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r svm1, message = FALSE, warning = FALSE}
svmResult.tissue.cv <- MLearn(tissue ~ ., eset.f, svmI , xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(svmResult.tissue.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do tipo de tecido:
</p>

```{r pecc5, message = FALSE, warning = FALSE}
precision(confuMat(svmResult.tissue.cv))
```

**Previs?o do perfil do indiv?duo**

<p style = 'text-align: justify;'>
Constru??o do modelo e resultados:
</p>

```{r svm2, message = FALSE, warning = FALSE}
svmResult.indivs.cv <- MLearn(individual ~ ., eset.f, svmI , xvalSpec("LOG", 10, balKfold.xvspec(10)))
addmargins(confuMat(svmResult.indivs.cv))
```

<p style = 'text-align: justify;'>
Precis?o do modelo para previs?o do perfil do indiv?duo:
</p>

```{r pecc6, message = FALSE, warning = FALSE}
precision(confuMat(svmResult.indivs.cv))
```

<p style = 'text-align: justify;'>
De um modo geral, os 3 tipos de modelos utilizados, k-vizinhos mais pr?ximos, ?rvores de regress?o e SVMs, apresentam um bom n?vel de precis?o na previs?o do tipo de tecido associado a cada amostra, sendo melhor o m?todo de k-vizinhos mais pr?ximos com um n?vel de precis?o de 97,96% para amostras de tecido normal e 100% para amostras de tecido tumoral. Tal como vimos na an?lise de clustering, existe uma clara separa??o entre os dois tipos de tecidos, o que poder? tornar o processo de previs?o mais f?cil, como vemos aqui.
</p>

<p style = 'text-align: justify;'>
Por outro lado, o n?vel de precis?o desce consideravelmente quando se trata de prever o perfil do indiv?duo associado a cada amostra, estando os n?veis de precis?o dos tr?s modelos para esta situa??o por volta e principalmente abaixo dos 50% (com exce??o da precisao do modelo de SVM para atuais fumadores, com 87,50%). Neste caso temos mais uma vari?vel a prever do que no caso anterior, o que torna ainda mais complicado o processo de previs?o. Al?m disso, esta diferen?a na previs?o entre tecidos e perfil do indiv?duo se deva ao facto de a diferen?a de expressao ser evidente entre celulas cancerigenas e normais (genes relacionados com ciclo celular, mitose, imunologia, etc.) e esta diferen?a n?o ser assim t?o evidente quando o que est? em causa ? se o indiv?duo consome ou n?o tabaco.
</p>


# Conclus?es

<p style = 'text-align: justify;'>
A an?lise de express?o diferencial em 107 amostras de tecido tumoral e tecido normal provenientes de pacientes atuais, antigos e nunca fumadores demonstrou que existem altera??es a n?vel gen?tico provocadas pelo consumo de tabaco. De facto, em amostras de indiv?duos fumadores verificou-se uma maior express?o de genes relacionados com o processo de divis?o/ciclo celular, processo de mitose e segrega??o dos cromossomas na an?lise com todas as fases tumorais ou apenas primeiras fases (ex. "TTK", "ECT2", "CENPF"). Este resultado ? consistente com o facto de as c?lulas cancer?genas apresentrem um elevado n?vel de prolifera??o celular e vai de necontro ao resultado obtido pelos autores deste estudo:
</p>

> "We found that smoking induces deregulation of this very mitotic process (...) comprises genes that regulate the mitotic spindle formation  (...) such as CENPF. (...) TTK  (linked to cell mitosis through EGFR,a critical drug target for lung adenocarcinoma."

<p style = 'text-align: justify;'>
As amostras provenientes de indiv?duos fumadores apresentavam uma menor express?o de genes relacionados com o processo de resposta de defesa celular e imunologia, em tecido tumoral (ex. "SDC1" e "CIRBP"). Em tecido normal esta tend?ncia inverte-se, sendo este tipo de genes sobrexpressos, entre eles o gene "CYP1B1" que codifica uma enzima capaz de metabolizar procarcin?genos. Este resultado tamb?m vai de encontro aos resultados obtidos pelos autores:
</p>

> "In the non-tumor tissue, current smoking strongly altered immune response genes, consistent with the defense mechanisms of the lung tissue against the acute toxic effects of smoking. (...) Our results are consistent with some previous findings, such as smoking-related alteration of CYP1B1"

<p style = 'text-align: justify;'>
Uma an?lise de express?o gen?tica entre antigos fumadores e atuais fumadores demonstrou que, para o crit?rio de signific?ncia definido, n?o existem genes diferencialmente expressos, o que poder? indicar que embora os pacientes j? tivessem deixado de fumar h? algum tempo as altera??es a n?vel da express?o dos genes se manteve.
</p>

<p style = 'text-align: justify;'>
Uma outra an?lise de express?o diferencial entre amostras provenientes de tecido normal e tecido tumoral demonstrou existirem mais genes subexpressos e menos genes sobrexpressos em tecido tumoral, resultado este tamb?m evidente pela an?lise de clustering hier?rquico, havendo uma clara separa??o entre amostras provenientes de tecido tumoral e normal. Da an?lise de enriquecimento verifica-se que uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com a divis?o celular, ciclo mit?tico e processos catab?licos de a??cares, o que est? de acordo com o esperado j? que as c?lulas cancer?genas evoluem no sentido de alterarem o seu metabolismo de forma a conseguirem uma mais r?pida prolifera??o.
</p>

<p style = 'text-align: justify;'>
Relativamente aos genes subexpressos verifica-se uma exist?ncia de "enriquecimento" estatisticamente significativo em genes cujos processos biol?gicos se relacionam com o desenvolvimento do sistema cardiovascular/circulat?rio, morfog?nese e desenvolvimento de vasos sangu?neos. Tal como referido, embora possa parecer contradit?rio relativamente ao que se sabe sobre o cancro, nomeadamente no que toca ao aumento do mecanismo de angiog?nese, sabe-se que em alguns tipos de cancro o mecanismo de angiog?nese n?o ? assim t?o relevante e ?, em muitos casos, diminuido, pelo que o adenocarcinoma pulmonar poder? ser um desses casos.
</p>

<p style = 'text-align: justify;'>
Realizada uma an?lise preditiva usando os m?todos de k-vizinhos mais pr?ximos, ?rvores de regress?o e SVMs conclui-se que os m?todos apresentam muito boa precis?o no que toca ? previs?o do tecido associado cada amostra, sendo melhor na previs?o o m?todo de k-vizinhos mais pr?ximos com um n?vel de precis?o de 97,96% para amostras de tecido normal e 100% para amostras de tecido tumoral. No entanto, para previs?o do perfil do indiv?duo associado a cada amostra tal n?o se verifica, estando os n?veis de precis?o dos tr?s modelos para esta situa??o por volta e principalmente abaixo dos 50% (com exce??o da precisao do modelo de SVM para atuais fumadores, com 87,50%), o que se poder? dever ? exist?ncia de uma clara separa??o entre os genes expressos nos dois tipos de tecido, como se verificou na an?lise de clustering, o que n?o ser? assim t?o evidente quando se trata de distinguir entre os perfis dos indiv?duos.
</p>

# Refer?ncias


